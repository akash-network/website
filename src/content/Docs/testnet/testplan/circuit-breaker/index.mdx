---
categories: ["Testnet"]
tags: ["Testnet", "BME", "Testing", "Circuit Breaker"]
title: "Circuit Breaker & Mint Status"
linkTitle: "Circuit Breaker"
description: "Test circuit breaker and mint status transitions - Requires Core Team"
weight: 7
---

**⚠️ NOTE: Circuit breaker states (Warning, HaltCR, HaltOracle) require the Akash Core team to intentionally adjust the price feeder to simulate severe AKT price movements. The Core team will announce a dedicated 24-hour circuit breaker testing window — the date and a schedule of state transitions will be announced in the testnet Discord channel. The schedule will specify time windows for each state (Warning, HaltCR, HaltOracle, Recovery) so testers know when to run each test. Tests 6.2-6.7 should only be run during this window.**

---

**Background - Circuit Breaker Mechanics:**

The **Collateralization Ratio** determines system health. It measures whether the vault has enough AKT to back all outstanding ACT:

```
Collateralization Ratio = (VaultAKT × OraclePrice) / OutstandingACT
```

Where:
- VaultAKT = AKT held in vault (backing)
- OraclePrice = Current AKT/USD price from oracle
- OutstandingACT = Total ACT in circulation (each ACT ≈ $1 USD)

When AKT price drops dramatically, the vault's USD value drops below the outstanding ACT liability, triggering the circuit breaker.

**Threshold Summary:**

| Status | Threshold | Behavior |
|--------|-----------|----------|
| Healthy | CR > 0.95 | All operations allowed |
| Warning | 0.90 < CR < 0.95 | Operations allowed, epoch timing increases |
| HaltCR | CR < 0.90 | New mints blocked, burns/refunds allowed |
| HaltOracle | Oracle stale | All BME operations blocked |

---

### Test 6.1: Observe MintStatusHealthy

**Objective:** Verify healthy status during normal operation

**User Actions:**
1. Ensure Collateralization Ratio is above warning threshold
2. Query mint status:
   ```bash
   akash query bme status
   ```
3. Perform normal operations (mint-act, create deployment)

**Expected Results:**
- `status`: `mint_status_healthy`
- `mints_allowed`: `true`
- `refunds_allowed`: `true`
- All operations proceed normally

**Proof to Submit:**
- BME status output showing `mint_status_healthy`
- Successful mint-act or deployment tx hash

---

### Test 6.2: Observe MintStatusWarning

**Objective:** Verify warning status when Collateralization Ratio approaches threshold

**Precondition:** Run during the announced circuit breaker testing window when CR is between warning and halt thresholds.

**User Actions:**
1. Query current status:
   ```bash
   akash query bme status
   ```
2. Wait for oracle price adjustment until Collateralization Ratio is between warn (0.95) and halt (0.90) thresholds
3. Query mint status again:
   ```bash
   akash query bme status
   ```
4. Attempt to mint ACT and create new deployment:
   ```bash
   akash tx bme mint-act 10000000uakt --from <wallet> -y
   ```

**Expected Results:**
- `status`: `mint_status_warning`
- `mints_allowed`: `true` (still allowed)
- `refunds_allowed`: `true`
- New mints and deployments still work
- Epoch timing may increase (settlements slow down)

**Proof to Submit:**
- BME status output showing `mint_status_warning`
- Successful mint-act tx hash (operations still allowed)

---

### Test 6.3: MintStatusHaltCR - New Mints Blocked

**Objective:** Verify new AKT→ACT conversions blocked when Collateralization Ratio below halt threshold

**Precondition:** Run during the announced circuit breaker testing window when CR is below halt threshold.

**User Actions:**
1. Wait for oracle price adjustment until Collateralization Ratio < 0.90 (halt threshold)
2. Query mint status:
   ```bash
   akash query bme status
   ```
   Confirm: `status: mint_status_halt_cr` and `mints_allowed: false`

3. Attempt to mint ACT:
   ```bash
   akash tx bme mint-act 10000000uakt --from <wallet> -y
   ```
4. Observe failure

**Expected Results:**
- `status`: `mint_status_halt_cr`
- `mints_allowed`: `false`
- `refunds_allowed`: `true`
- Mint-act transaction **fails** with circuit breaker error
- Burn-act still works (users can exit positions)

**Proof to Submit:**
- BME status output showing `mint_status_halt_cr` and `mints_allowed: false`
- Error message from failed mint-act attempt
- Successful burn-act tx hash (showing exits still work)

---

### Test 6.4: MintStatusHaltOracle - Oracle Failure

**Objective:** Verify system halts when oracle unavailable (separate from Collateralization Ratio halt)

**Precondition:** Run during the announced circuit breaker testing window when oracle staleness is being tested.

**User Actions:**
1. Wait for oracle price feeder to be stopped (no price updates)
2. Wait for oracle staleness threshold
3. Query mint status:
   ```bash
   akash query bme status
   ```
4. Attempt operations:
   ```bash
   akash tx bme mint-act 10000000uakt --from <wallet> -y
   ```

**Expected Results:**
- `status`: `mint_status_halt_oracle`
- `mints_allowed`: `false`
- Operations fail with oracle error
- Distinct from `mint_status_halt_cr` (different root cause)

**Proof to Submit:**
- BME status output showing `mint_status_halt_oracle`
- Error message from failed operation

---

### Test 6.5: Existing Deployments Continue During Halt

**Objective:** Verify running deployments unaffected by circuit breaker

**Precondition:** Have an active deployment running before circuit breaker is triggered.

**User Actions:**
1. Create deployment while system is healthy (see Category 1 for full workflow):
   ```bash
   akash tx bme mint-act 100000000uakt --from <wallet> -y
   sleep 60
   akash tx deployment create deploy.yml --deposit 50000000uact --from <wallet> -y
   # Complete lease creation and send manifest...
   ```

2. Confirm deployment running:
   ```bash
   akash query market lease list --owner <user-address>
   ```

3. Wait for circuit breaker to be triggered (HaltCR)

4. Verify existing deployment continues running:
   ```bash
   akash query market lease list --owner <user-address>
   akash query deployment get --owner <user-address> --dseq <dseq>
   ```

5. Monitor for multiple settlement epochs — provider should continue receiving ACT

**Expected Results:**
- Existing deployments **unaffected**
- Lease remains active
- Providers continue receiving ACT payments
- Only new ACT minting (AKT→ACT) is blocked
- Existing ACT can still be used for new deployments
- Provider burn-act still works

**Proof to Submit:**
- Lease list before and after circuit breaker trigger (showing still active)
- BME status showing halt state
- Provider balance showing continued ACT receipt

---

### Test 6.6: Circuit Breaker Recovery

**Objective:** Verify system resumes when Collateralization Ratio recovers

**User Actions:**
1. Start with circuit breaker in HaltCR state
2. Confirm new mint-act fails:
   ```bash
   akash query bme status
   akash tx bme mint-act 10000000uakt --from <wallet> -y
   # Expected: FAIL
   ```

3. Wait for price feeder to be restored / price adjusted upward

4. Wait for price to update and Collateralization Ratio to recover

5. Query mint status:
   ```bash
   akash query bme status
   ```

6. Attempt to mint ACT:
   ```bash
   akash tx bme mint-act 10000000uakt --from <wallet> -y
   ```

**Expected Results:**
- Status transitions: `mint_status_halt_cr` → `mint_status_warning` → `mint_status_healthy`
- `mints_allowed` becomes `true` again
- New mints succeed
- No manual intervention required beyond restoring price feed
- Vault state remains consistent (no corruption)

**Proof to Submit:**
- BME status showing halt state before recovery
- BME status showing healthy state after recovery
- Successful mint-act tx hash after recovery

---

### Test 6.7: Mint Status State Transitions

**Objective:** Verify all valid state transitions occur correctly

**Test Matrix:**

| From | To | Trigger |
|------|-----|---------|
| Healthy | Warning | CR drops below 0.95 |
| Warning | Healthy | CR rises above 0.95 |
| Warning | HaltCR | CR drops below 0.90 |
| HaltCR | Warning | CR rises above 0.90 |
| Any | HaltOracle | Oracle becomes unavailable/stale |
| HaltOracle | Previous | Oracle recovers |

**User Actions:**
1. During the testing window, observe each transition as Core team adjusts price feeder
2. Query status after each change:
   ```bash
   akash query bme status
   ```
3. Verify state transitions match expected behavior
4. Confirm operations allowed/blocked appropriately at each state

**Expected Results:**
- All transitions occur as documented
- No invalid state combinations
- System recovers cleanly from each halt state
- Vault state remains consistent throughout

**Proof to Submit:**
- BME status output at each state transition
- Summary table of observed transitions matching test matrix